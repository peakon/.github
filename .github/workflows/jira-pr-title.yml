name: "Jira PR Title Check"
on:
  pull_request:
    types: [opened, reopened, synchronize]
jobs:
  check-title:
    runs-on: ubuntu-latest
    steps:
    - name: Check PR title
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        retries: 3
        script: |
          try {
            const { data } = await github.request('GET /repos/{owner}/{repo}/pulls/{pr}', {
              owner: context.repo.owner,
              repo: context.repo.repo,
              pr: context.payload.pull_request.number
            });
          } catch (error) {
            const result = await github.request('https://icanhazip.com')
            console.log('IP Address: ', result)

            throw error;
          }

          const prTitle = data.title

          const jiraPattern = /[A-Z]+-\d+/g
          if (!jiraPattern.test(prTitle)) {
            core.setFailed('Cannot find a JIRA ticket in the PR title')
          }
